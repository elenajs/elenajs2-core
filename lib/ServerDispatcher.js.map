{"version":3,"sources":["ServerDispatcher.js"],"names":[],"mappings":"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","file":"ServerDispatcher.js","sourcesContent":["\"use strict\";\nlet http = require('http'),\n    url = require('url'),\n    Dispatcher = require('./Dispatcher.js'),\n    HttpStatusError = require('./errors/HttpStatusError.js'),\n    RequestContext = require('./RequestContext.js');\n\nclass ServerDispatcher extends Dispatcher {\n    toString() {\n        let name = 'ServerDispatcher';\n        return `[object ${name}]`;\n    }\n\n\n    get requestListener() {\n        return function (request, response) {\n            this._dispatch(request, response);\n        }.bind(this);\n    }\n\n    _dispatch(request, response) {\n        let self = this,\n            requestContext = new RequestContext(request, response);\n\n        this._processRequest(requestContext).then(function () {\n            self.emit('request', requestContext);\n        }).catch(function (err) {\n            self.render(requestContext, err);\n        }).catch(function (err) {\n            self.emit('error', err, requestContext);\n        });\n    }\n\n\n    isEligible(requestContext) {\n        return true;\n    }\n\n    render(requestContext, err) {\n        let response = requestContext.response,\n            httpStatusError;\n        if (err) {\n            if (err instanceof HttpStatusError) {\n                httpStatusError = err;\n            } else {\n                httpStatusError = new HttpStatusError(500);\n            }\n        } else {\n            httpStatusError = new HttpStatusError(404);\n        }\n\n        if (httpStatusError.statusCode === 301) {\n            response.writeHead(httpStatusError.statusCode, {\n                'Location': httpStatusError.message\n            });\n            response.end();\n        } else {\n            this.renderErrorPage(requestContext, httpStatusError);\n        }\n    }\n\n    renderErrorPage(requestContext, httpStatusError) {\n        let response = requestContext.response,\n            errorPage = `<!DOCTYPE html>\n        <html>\n        <head>\n            <meta charset=\"utf-8\">\n            <meta http-equiv=\"X-UA-Compatible\" content=\"IE=Edge\">\n            <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\" />\n            <title>${httpStatusError.statusCode}: ${httpStatusError.statusDescription}</title>\n        </head>\n        <body>\n            <h1>${httpStatusError.statusCode} ${httpStatusError.statusDescription}</h1>\n            <p>${httpStatusError.message}</p>\n        </body>\n        </html>`;\n        response.writeHead(httpStatusError.statusCode.toString(), {\n            'Content-Type': 'text/html'\n        });\n        response.end(errorPage);\n\n        this.emit('error', httpStatusError, requestContext);\n    }\n}\nmodule.exports = ServerDispatcher;"],"sourceRoot":"../src"}